<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>HOT NIGGA</title>
        <script src="js/phaser.js"></script>
        <style>
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.AUTO, 'towerdef', { preload: preload, create: create, update: update });

        function generateWorld (level, scale) {

            var entry = 0;
            var tempsprite;

            for(var y = 0; y<level.length; y++) {
                for(var x = 0; x<level[y].length; x++) {

                    if(level[y][x] == 0) {
                        if( y==0 ) {
                            entry = ((x*128)+64)*scale;
                        }

                        tempsprite = game.add.sprite((x*128)*scale, (y*128)*scale, 'path');
                        tempsprite.scale.x = scale;
                        tempsprite.scale.y = scale;

                    } else if(level[y][x] == 1) {

                        tempsprite = game.add.sprite((x*128)*scale, (y*128)*scale, 'grass');
                        tempsprite.scale.x = scale;
                        tempsprite.scale.y = scale;

                    }
                }
            }
            return entry;
        }

        function spawnEnemy (entrypoint, scale) {
            var enemy = game.add.sprite(entrypoint + (game.rnd.integerInRange(0, 20) - game.rnd.integerInRange(0, 20))*scale, 0, 'enemy');
            enemy.anchor.setTo(0.5, 0.5);
            game.physics.enable(enemy, Phaser.Physics.ARCADE);
            return enemy;
        }

        function preload () {

            game.load.image('enemy', 'img/enemy.png');
            game.load.image('path', 'img/path.png');
            game.load.image('grass', 'img/grass.png');
			game.load.image('player', 'img/player.png');
			game.load.audio('hotnigga', ['snd/htngg.mp3']);
			game.stage.backgroundColor = '#555555';

        }

		var music;
		var time = 0;
        var entrypoint;
        var player;
        var enemygroup;

        function create () {
		
			text = game.add.text(game.world.centerX, game.world.centerY, "Test", {
			font: "12pt Arial",
			fill: "#ff0044",
			align: "center"
			});

            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.physics.arcade.setBounds(0, 0, game.width, game.height);
		
		    music = game.add.audio('hotnigga');
			//music.play();


            var level = [
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1]
            ];

            entrypoint = generateWorld(level, 1.0);

            player = game.add.sprite(game.world.centerX,game.world.centerY, 'player');
            player.anchor.setTo(0.5, 0.5);

            enemygroup = new Phaser.Group(game);

			game.physics.enable(player, Phaser.Physics.ARCADE);

            player.body.collideWorldBounds = true;
			//repeats spawning enemies(seconds,amount of times,function)
			game.time.events.repeat(Phaser.Timer.SECOND * 2,1000,enemyWave,this)
        }
		//repeated function
		function enemyWave(){
		 enemygroup.add(spawnEnemy(entrypoint, 1.0));
		}
		function update() {
				
				time += game.time.physicsElapsed;
				
				text.setText(Math.round(time));

                 enemygroup.forEach(game.physics.arcade.moveToXY, game.physics.arcade, false, entrypoint, 1000, 200);
				
				if (game.input.activePointer.isDown)
				{
					game.physics.arcade.moveToPointer(player, 200);
				}

                if(game.physics.arcade.distanceToPointer(player) < 16) {
                    player.body.velocity.set(0);
                }
		
			}

    };

    </script>

    </body>
</html>